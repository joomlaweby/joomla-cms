"use strict";((a,b)=>{if(!b)throw new Error("Joomla API is not properly initiated");b.selectedFile={},window.document.addEventListener("onMediaFileSelected",a=>{b.selectedFile=a.detail});const c=(a,c,d)=>{if(!0===a.success){if(!a.data[0].url)b.selectedFile.url=!1;else if(/local-/.test(a.data[0].adapter)){const{rootFull:c}=b.getOptions("system.paths");b.selectedFile.url=a.data[0].url.split(c)[1],b.selectedFile.thumb=!!a.data[0].thumb_path&&a.data[0].thumb_path}else a.data[0].thumb_path&&(b.selectedFile.thumb=a.data[0].thumb_path);const e=a=>"object"==typeof HTMLElement?a instanceof HTMLElement:a&&"object"==typeof a&&null!==a&&1===a.nodeType&&"string"==typeof a.nodeName;b.selectedFile.url&&(e(c)||"object"==typeof c?!e(c)&&"object"==typeof c&&c.id?window.parent.Joomla.editors.instances[c.id].replaceSelection(`<img loading="lazy" src="${b.selectedFile.url}" alt=""/>`):(c.value=b.selectedFile.url,d.updatePreview()):b.editors.instances[c].replaceSelection(`<img loading="lazy" src="${b.selectedFile.url}" alt=""/>`))}};b.getImage=(a,d,e)=>new Promise((f,g)=>{if(!a||"object"==typeof a&&(!a.path||""===a.path))return b.selectedFile={},void f({resp:{success:!1}});const h=`${b.getOptions("system.paths").baseFull}index.php?option=com_media&format=json`;b.request({url:`${h}&task=api.files&url=true&path=${a.path}&${b.getOptions("csrf.token")}=1&format=json`,method:"GET",perform:!0,headers:{"Content-Type":"application/json"},onSuccess:a=>{const b=JSON.parse(a);f(c(b,d,e))},onError:a=>{g(a)}})});class d extends HTMLElement{constructor(){super(),this.onSelected=this.onSelected.bind(this),this.show=this.show.bind(this),this.clearValue=this.clearValue.bind(this),this.modalClose=this.modalClose.bind(this),this.setValue=this.setValue.bind(this),this.updatePreview=this.updatePreview.bind(this)}static get observedAttributes(){return["type","base-path","root-folder","url","modal-container","modal-width","modal-height","input","button-select","button-clear","button-save-selected","preview","preview-width","preview-height"]}get type(){return this.getAttribute("type")}set type(a){this.setAttribute("type",a)}get basePath(){return this.getAttribute("base-path")}set basePath(a){this.setAttribute("base-path",a)}get rootFolder(){return this.getAttribute("root-folder")}set rootFolder(a){this.setAttribute("root-folder",a)}get url(){return this.getAttribute("url")}set url(a){this.setAttribute("url",a)}get modalContainer(){return this.getAttribute("modal-container")}set modalContainer(a){this.setAttribute("modal-container",a)}get input(){return this.getAttribute("input")}set input(a){this.setAttribute("input",a)}get buttonSelect(){return this.getAttribute("button-select")}set buttonSelect(a){this.setAttribute("button-select",a)}get buttonClear(){return this.getAttribute("button-clear")}set buttonClear(a){this.setAttribute("button-clear",a)}get buttonSaveSelected(){return this.getAttribute("button-save-selected")}set buttonSaveSelected(a){this.setAttribute("button-save-selected",a)}get modalWidth(){return this.getAttribute(parseInt("modal-width",10))}set modalWidth(a){this.setAttribute("modal-width",a)}get modalHeight(){return this.getAttribute(parseInt("modal-height",10))}set modalHeight(a){this.setAttribute("modal-height",a)}get previewWidth(){return this.getAttribute(parseInt("preview-width",10))}set previewWidth(a){this.setAttribute("preview-width",a)}get previewHeight(){return this.getAttribute(parseInt("preview-height",10))}set previewHeight(a){this.setAttribute("preview-height",a)}get preview(){return this.getAttribute("preview")}set preview(a){this.setAttribute("preview",a)}get previewContainer(){return this.getAttribute("preview-container")}connectedCallback(){if(this.button=this.querySelector(this.buttonSelect),this.inputElement=this.querySelector(this.input),this.buttonClearEl=this.querySelector(this.buttonClear),this.modalElement=this.querySelector(".joomla-modal"),this.buttonSaveSelectedElement=this.querySelector(this.buttonSaveSelected),this.previewElement=this.querySelector(".field-media-preview"),!this.button||!this.inputElement||!this.buttonClearEl||!this.modalElement||!this.buttonSaveSelectedElement)throw new Error("Misconfiguaration...");b.Bootstrap&&b.Bootstrap.initModal&&"function"==typeof b.Bootstrap.initModal&&b.Bootstrap.initModal(this.modalElement),this.button.addEventListener("click",this.show),this.buttonClearEl&&this.buttonClearEl.addEventListener("click",this.clearValue),this.updatePreview()}disconnectedCallback(){this.button&&this.button.removeEventListener("click",this.show),this.buttonClearEl&&this.buttonClearEl.removeEventListener("click",this.clearValue)}onSelected(a){return a.preventDefault(),a.stopPropagation(),this.modalClose(),!1}show(){this.modalElement.open(),b.selectedFile={},this.buttonSaveSelectedElement.addEventListener("click",this.onSelected)}modalClose(){b.getImage(b.selectedFile,this.inputElement,this).then(()=>{b.Modal.getCurrent().close(),b.selectedFile={}}).catch(()=>{b.Modal.getCurrent().close(),b.selectedFile={},b.renderMessages({error:[b.Text._("JLIB_APPLICATION_ERROR_SERVER")]})})}setValue(a){this.inputElement.value=a,this.updatePreview()}clearValue(){this.setValue("")}updatePreview(){if(-1!==["true","static"].indexOf(this.preview)&&"false"!==this.preview&&this.previewElement&&this.preview){const{value:a}=this.inputElement;if(!a)this.previewElement.innerHTML="<span class=\"field-media-preview-icon\"></span>";else{this.previewElement.innerHTML="";const c=new Image;switch(this.type){case"image":c.src=/http/.test(a)?a:b.getOptions("system.paths").rootFull+a,c.setAttribute("alt","");break;default:}this.previewElement.style.width=this.previewWidth,this.previewElement.appendChild(c)}}}}a.define("joomla-field-media",d)})(customElements,Joomla);